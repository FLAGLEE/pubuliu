<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #container {
            position: relative;
        }

        .box {
            padding: 5px;
            float: left;
        }

        .box_img {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 5px #ccc;
        }

        .box_img img {
            width: 200px;
            height: auto;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div id="container">
        <div class="box">
            <div class="box_img"><img src="img/film/1.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/2.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/3.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/4.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/5.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/6.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/7.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/8.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/9.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/10.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/11.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/12.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/13.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/14.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/15.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/16.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/17.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/18.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/19.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/20.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/21.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/22.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/23.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/24.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/25.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/26.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/27.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/28.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/29.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/30.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/31.jpg" alt=""></div>
        </div>
        <div class="box">
            <div class="box_img"><img src="img/film/32.jpg" alt=""></div>
        </div>
    </div>
    <script>
        window.onload = function () {
            imgLocation("container", "box");

            var imgData = {
                "data": [{
                    "src": "1.jpg"
                }, {
                    "src": "2.jpg"
                }, {
                    "src": "3.jpg"
                }, {
                    "src": "4.jpg"
                }, {
                    "src": "5.jpg"
                }, {
                    "src": "6.jpg"
                }, {
                    "src": "7.jpg"
                }, {
                    "src": "8.jpg"
                }, {
                    "src": "9.jpg"
                }, {
                    "src": "10.jpg"
                }, {
                    "src": "11.jpg"
                }, {
                    "src": "12.jpg"
                }, {
                    "src": "13.jpg"
                }, {
                    "src": "14.jpg"
                }, {
                    "src": "15.jpg"
                }, {
                    "src": "16.jpg"
                }, {
                    "src": "17.jpg"
                }, {
                    "src": "18.jpg"
                }, {
                    "src": "19.jpg"
                }, {
                    "src": "20.jpg"
                }, {
                    "src": "21.jpg"
                }, {
                    "src": "22.jpg"
                }, {
                    "src": "23.jpg"
                }, {
                    "src": "24.jpg"
                }, {
                    "src": "25.jpg"
                }, {
                    "src": "26.jpg"
                }, {
                    "src": "27.jpg"
                }, {
                    "src": "28.jpg"
                }, {
                    "src": "29.jpg"
                }, {
                    "src": "30.jpg"
                }, {
                    "src": "31.jpg"
                }, {
                    "src": "32.jpg"
                }]
            }

            window.onscroll = function () {
                if (checkFlag()) {
                    var cparent = document.getElementById("container");
                    for (var i = 0; i < imgData.data.length; i++) {
                        var ccontent = document.createElement("div");
                        // console.log("createElement div success");
                        ccontent.className = "box";
                        cparent.appendChild(ccontent);
                        var boximg = document.createElement("div");
                        boximg.className = "box_img";
                        ccontent.appendChild(boximg);
                        var img = document.createElement("img");
                        img.src = "img/film/" + imgData.data[i].src;
                        console.log(imgData.data.length, img.src);
                        boximg.appendChild(img);
                    }
                }
                imgLocation("container", "box");
            }

        }


        function checkFlag() {
            var cparent = document.getElementById("container");
            var ccontent = getChildElement(cparent, "box");
            var lastContentHeight = ccontent[ccontent.length - 1].offsetTop;
            var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            var pageHeight = document.documentElement.clientHeight || document.body.clientHeight;
            console.log(lastContentHeight + ":" + scrollTop + ":" + pageHeight);
            if (lastContentHeight < scrollTop + pageHeight) {
                // console.log("return true");
                return true;

            }
        }

        function imgLocation(parent, content) {
            var cparent = document.getElementById(parent);
            var ccontent = getChildElement(cparent, content);
            // console.log(ccontent);
            var imgWidth = ccontent[0].offsetWidth;
            // console.log(imgWidth);
            var cols = Math.floor(document.documentElement.clientWidth / imgWidth);
            // console.log(cols);
            cparent.style.cssText = "width:" + imgWidth * cols + "px;margin:0 auto;"

            var BoxHeightArr = [];
            for (var i = 0; i < ccontent.length; i++) {
                if (i < cols) {
                    BoxHeightArr[i] = ccontent[i].offsetHeight;
                } else {
                    // console.log(BoxHeightArr);
                    var minHeight = Math.min.apply(null, BoxHeightArr); ////////////////////
                    var minIndex = getMinHeightLocation(BoxHeightArr, minHeight);
                    // console.log(minHeight, minIndex)
                    ccontent[i].style.position = "absolute";
                    ccontent[i].style.top = minHeight + "px";
                    ccontent[i].style.left = ccontent[minIndex].offsetLeft + "px";
                    BoxHeightArr[minIndex] = BoxHeightArr[minIndex] + ccontent[i].offsetHeight;
                }
            }
        }

        function getMinHeightLocation(Arr, Height) {
            for (var i in Arr) {
                if (Arr[i] == Height) {
                    return i;
                }
            }
        }

        function getChildElement(parent, content) {
            var contentArr = [];
            var allContent = parent.getElementsByTagName("*");
            for (var i = 0; i < allContent.length; i++) {
                if (allContent[i].className == content) {
                    contentArr.push(allContent[i]);
                }
            }
            return contentArr;
        }
    </script>
</body>

</html>